<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration UI Interactive Test Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .test-pass {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-fail {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-pending {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.375rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">
            <i class="fas fa-vial"></i> Migration UI Interactive Test Suite
        </h1>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>Instructions:</strong> This test suite will help you manually test all aspects of the Migration Management Web UI.
            Make sure the web server is running at <code>http://localhost:8000</code> before starting.
        </div>

        <!-- Test Progress -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-chart-line"></i> Test Progress</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-3">
                    <div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar">0%</div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 id="passedCount" class="text-success">0</h4>
                            <small>Passed</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 id="failedCount" class="text-danger">0</h4>
                            <small>Failed</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 id="totalCount" class="text-info">0</h4>
                            <small>Total</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Categories -->
        <div class="accordion" id="testAccordion">
            
            <!-- Dashboard Tests -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="dashboardHeader">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#dashboardTests">
                        <i class="fas fa-tachometer-alt me-2"></i> Dashboard Functionality Tests
                    </button>
                </h2>
                <div id="dashboardTests" class="accordion-collapse collapse show" data-bs-parent="#testAccordion">
                    <div class="accordion-body">
                        <div class="test-item mb-3">
                            <h6>Test 1: Load Main Dashboard</h6>
                            <p>Open the main UI and verify dashboard loads correctly.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Open <a href="http://localhost:8000" target="_blank">http://localhost:8000</a><br>
                                2. Verify 4 dashboard cards show migration statistics<br>
                                3. Check that numbers are displayed (Applied, Pending, Total, Backups)
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('dashboard-load', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('dashboard-load', false)">❌ Fail</button>
                            <div id="result-dashboard-load" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 2: Navigation Tabs</h6>
                            <p>Test that all navigation tabs work correctly.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Click each tab: "All Versions", "Upload Migration", "Rollback", "Backups"<br>
                                2. Verify each tab content loads without errors<br>
                                3. Verify tab highlighting works correctly
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('navigation-tabs', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('navigation-tabs', false)">❌ Fail</button>
                            <div id="result-navigation-tabs" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 3: Auto-refresh Functionality</h6>
                            <p>Verify dashboard auto-refreshes every 30 seconds.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Note the current time and dashboard numbers<br>
                                2. Wait 30+ seconds and observe if data refreshes<br>
                                3. Check browser network tab for API calls
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('auto-refresh', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('auto-refresh', false)">❌ Fail</button>
                            <div id="result-auto-refresh" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Versions Tests -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="versionsHeader">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#versionsTests">
                        <i class="fas fa-code-branch me-2"></i> All Versions Tab Tests
                    </button>
                </h2>
                <div id="versionsTests" class="accordion-collapse collapse" data-bs-parent="#testAccordion">
                    <div class="accordion-body">
                        <div class="test-item mb-3">
                            <h6>Test 4: Migration Timeline Display</h6>
                            <p>Verify the migration timeline displays correctly.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Go to "All Versions" tab<br>
                                2. Check if migrations are displayed in timeline format<br>
                                3. Verify status indicators (applied/pending) are correct<br>
                                4. Check risk level badges are color-coded
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('timeline-display', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('timeline-display', false)">❌ Fail</button>
                            <div id="result-timeline-display" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 5: Apply Migrations Button</h6>
                            <p>Test the "Apply with Backup" functionality.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Check if "Apply with Backup" button is enabled/disabled correctly<br>
                                2. If enabled, click it and verify confirmation dialog<br>
                                3. Test the backup creation and migration application process
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('apply-migrations', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('apply-migrations', false)">❌ Fail</button>
                            <div id="result-apply-migrations" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 6: Rollback Buttons</h6>
                            <p>Test rollback button functionality on applied migrations.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Look for "Rollback to here" buttons on applied migrations<br>
                                2. Click one and verify it switches to Rollback tab<br>
                                3. Check that the target version is pre-selected
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('rollback-buttons', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('rollback-buttons', false)">❌ Fail</button>
                            <div id="result-rollback-buttons" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Migration Tests -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="uploadHeader">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#uploadTests">
                        <i class="fas fa-upload me-2"></i> Upload Migration Tab Tests
                    </button>
                </h2>
                <div id="uploadTests" class="accordion-collapse collapse" data-bs-parent="#testAccordion">
                    <div class="accordion-body">
                        <div class="test-item mb-3">
                            <h6>Test 7: Form Auto-population</h6>
                            <p>Verify form fields auto-populate correctly.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Go to "Upload Migration" tab<br>
                                2. Check that Migration ID shows "Next available: XXX"<br>
                                3. Verify Author field is pre-filled<br>
                                4. Test that commit message auto-updates when ID/description change
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('form-auto-population', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('form-auto-population', false)">❌ Fail</button>
                            <div id="result-form-auto-population" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 8: Form Validation</h6>
                            <p>Test client-side form validation.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Try submitting form with empty required fields<br>
                                2. Verify browser shows validation messages<br>
                                3. Fill in invalid data and test error handling<br>
                                4. Test SQL content validation
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('form-validation', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('form-validation', false)">❌ Fail</button>
                            <div id="result-form-validation" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 9: GitHub Integration (Optional)</h6>
                            <p>Test GitHub upload functionality if you have a token.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Fill in all form fields with valid test data<br>
                                2. Add a GitHub token (if available)<br>
                                3. Submit form and verify success/error handling<br>
                                4. Check if PR link is provided on success
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('github-integration', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('github-integration', false)">❌ Fail</button>
                            <button class="btn btn-secondary btn-sm" onclick="markTest('github-integration', 'skip')">⏭️ Skip</button>
                            <div id="result-github-integration" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rollback Tests -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="rollbackHeader">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#rollbackTests">
                        <i class="fas fa-undo me-2"></i> Rollback Tab Tests
                    </button>
                </h2>
                <div id="rollbackTests" class="accordion-collapse collapse" data-bs-parent="#testAccordion">
                    <div class="accordion-body">
                        <div class="test-item mb-3">
                            <h6>Test 10: Rollback Form Population</h6>
                            <p>Verify rollback dropdowns populate correctly.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Go to "Rollback" tab<br>
                                2. Check "Target Migration Version" dropdown has applied migrations<br>
                                3. Check "Backup File" dropdown shows available backups<br>
                                4. Verify environment selection works
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('rollback-form', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('rollback-form', false)">❌ Fail</button>
                            <div id="result-rollback-form" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 11: Rollback Confirmations</h6>
                            <p>Test safety confirmation mechanisms.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Try submitting without checking confirmation checkbox<br>
                                2. Select "Production" environment and test additional warnings<br>
                                3. Verify destructive operation warnings are clear<br>
                                4. Test form validation for required fields
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('rollback-confirmations', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('rollback-confirmations', false)">❌ Fail</button>
                            <div id="result-rollback-confirmations" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup Tests -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="backupHeader">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#backupTests">
                        <i class="fas fa-save me-2"></i> Backup Tab Tests
                    </button>
                </h2>
                <div id="backupTests" class="accordion-collapse collapse" data-bs-parent="#testAccordion">
                    <div class="accordion-body">
                        <div class="test-item mb-3">
                            <h6>Test 12: Backup List Display</h6>
                            <p>Verify backup files are listed correctly.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Go to "Backups" tab<br>
                                2. Check if existing backups are displayed in table<br>
                                3. Verify file information (name, size, date, type) is shown<br>
                                4. Check "Use for Rollback" buttons work
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('backup-list', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('backup-list', false)">❌ Fail</button>
                            <div id="result-backup-list" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 13: Create Backup</h6>
                            <p>Test manual backup creation functionality.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Click "Create Backup" button<br>
                                2. Verify loading modal appears<br>
                                3. Check success message shows backup details<br>
                                4. Verify new backup appears in the list
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('create-backup', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('create-backup', false)">❌ Fail</button>
                            <div id="result-create-backup" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 14: Backup Integration</h6>
                            <p>Test backup integration with rollback functionality.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Click "Use for Rollback" on a backup file<br>
                                2. Verify it switches to Rollback tab<br>
                                3. Check that the backup file is pre-selected<br>
                                4. Test the complete integration workflow
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('backup-integration', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('backup-integration', false)">❌ Fail</button>
                            <div id="result-backup-integration" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Handling Tests -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="errorHeader">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errorTests">
                        <i class="fas fa-exclamation-triangle me-2"></i> Error Handling Tests
                    </button>
                </h2>
                <div id="errorTests" class="accordion-collapse collapse" data-bs-parent="#testAccordion">
                    <div class="accordion-body">
                        <div class="test-item mb-3">
                            <h6>Test 15: Network Error Handling</h6>
                            <p>Test behavior when API calls fail.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Stop the web server temporarily<br>
                                2. Try refreshing the page or performing actions<br>
                                3. Verify error messages are user-friendly<br>
                                4. Restart server and verify recovery
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('network-errors', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('network-errors', false)">❌ Fail</button>
                            <div id="result-network-errors" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>

                        <div class="test-item mb-3">
                            <h6>Test 16: Modal Functionality</h6>
                            <p>Test loading, success, and error modals.</p>
                            <div class="code-block mb-2">
                                <strong>Steps:</strong><br>
                                1. Trigger actions that show loading modals<br>
                                2. Verify success modals display correctly<br>
                                3. Test error modals with appropriate styling<br>
                                4. Check modal close functionality
                            </div>
                            <button class="btn btn-success btn-sm" onclick="markTest('modal-functionality', true)">✅ Pass</button>
                            <button class="btn btn-danger btn-sm" onclick="markTest('modal-functionality', false)">❌ Fail</button>
                            <div id="result-modal-functionality" class="test-result test-pending mt-2" style="display:none;">Pending...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Results -->
        <div class="card mt-4" id="finalResults" style="display:none;">
            <div class="card-header bg-primary text-white">
                <h5><i class="fas fa-flag-checkered"></i> Final Test Results</h5>
            </div>
            <div class="card-body">
                <div id="finalSummary"></div>
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-download"></i> Download Test Report
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testResults = {};
        let totalTests = 16;

        function markTest(testId, result) {
            testResults[testId] = result;
            
            const resultDiv = document.getElementById(`result-${testId}`);
            resultDiv.style.display = 'block';
            
            if (result === true) {
                resultDiv.className = 'test-result test-pass mt-2';
                resultDiv.innerHTML = '<i class="fas fa-check-circle"></i> Test Passed';
            } else if (result === false) {
                resultDiv.className = 'test-result test-fail mt-2';
                resultDiv.innerHTML = '<i class="fas fa-times-circle"></i> Test Failed';
            } else if (result === 'skip') {
                resultDiv.className = 'test-result test-pending mt-2';
                resultDiv.innerHTML = '<i class="fas fa-forward"></i> Test Skipped';
            }
            
            updateProgress();
        }

        function updateProgress() {
            const completed = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r === true).length;
            const failed = Object.values(testResults).filter(r => r === false).length;
            
            const percentage = (completed / totalTests) * 100;
            
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressBar').textContent = Math.round(percentage) + '%';
            
            document.getElementById('passedCount').textContent = passed;
            document.getElementById('failedCount').textContent = failed;
            document.getElementById('totalCount').textContent = completed + '/' + totalTests;
            
            if (completed === totalTests) {
                showFinalResults();
            }
        }

        function showFinalResults() {
            const passed = Object.values(testResults).filter(r => r === true).length;
            const failed = Object.values(testResults).filter(r => r === false).length;
            const skipped = Object.values(testResults).filter(r => r === 'skip').length;
            
            let summaryClass = 'alert-success';
            let summaryIcon = 'fa-check-circle';
            let summaryText = 'All tests completed successfully!';
            
            if (failed > 0) {
                summaryClass = 'alert-danger';
                summaryIcon = 'fa-exclamation-triangle';
                summaryText = `${failed} test(s) failed. Please review and fix issues.`;
            } else if (skipped > 0) {
                summaryClass = 'alert-warning';
                summaryIcon = 'fa-info-circle';
                summaryText = `All tests passed (${skipped} skipped).`;
            }
            
            document.getElementById('finalSummary').innerHTML = `
                <div class="alert ${summaryClass}">
                    <i class="fas ${summaryIcon}"></i> ${summaryText}
                </div>
                <div class="row">
                    <div class="col-md-4 text-center">
                        <h3 class="text-success">${passed}</h3>
                        <p>Passed</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 class="text-danger">${failed}</h3>
                        <p>Failed</p>
                    </div>
                    <div class="col-md-4 text-center">
                        <h3 class="text-warning">${skipped}</h3>
                        <p>Skipped</p>
                    </div>
                </div>
            `;
            
            document.getElementById('finalResults').style.display = 'block';
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                total_tests: totalTests,
                completed_tests: Object.keys(testResults).length,
                passed_tests: Object.values(testResults).filter(r => r === true).length,
                failed_tests: Object.values(testResults).filter(r => r === false).length,
                skipped_tests: Object.values(testResults).filter(r => r === 'skip').length,
                test_results: testResults
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ui_test_report_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>